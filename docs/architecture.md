# ğŸ—ï¸ Architecture

## ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Golf Platform Ecosystem                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  [Client Mobile App]                                        â”‚
â”‚           â†“                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   NestJS Backend API                â”‚                   â”‚
â”‚  â”‚   (platform repo)                   â”‚                   â”‚
â”‚  â”‚   - ì‚¬ìš©ì ì¸ì¦ (Google OAuth)        â”‚                   â”‚
â”‚  â”‚   - ê³¨í”„ì¥ ê²€ìƒ‰ (Redis GEO) etc..     â”‚                   â”‚
â”‚  â”‚   - ìŠ¤ìœ™ ë¶„ì„ ìš”ì²­ ê´€ë¦¬                 â”‚                   â”‚
â”‚  â”‚   - ê²°ê³¼ DB ì €ì¥                      â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚           â†“ HTTP POST /analyze                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   FastAPI AI Service (ì´ ë ˆí¬)       â”‚                   â”‚
â”‚  â”‚   - ì˜ìƒ ì „ì²˜ë¦¬ (FFmpeg)             â”‚                   â”‚
â”‚  â”‚   - MediaPipe ê³¨ê²© ì¶”ì¶œ              â”‚                   â”‚
â”‚  â”‚   - LSTM Phase ê°ì§€                  â”‚                   â”‚
â”‚  â”‚   - ê°ë„ ê³„ì‚° & ì§„ë‹¨                  â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚           â†“ JSON Response                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   MySQL (RDS)                       â”‚                   â”‚
â”‚  â”‚   - ì‚¬ìš©ì ë°ì´í„°                     â”‚                   â”‚
â”‚  â”‚   - ë¶„ì„ ê²°ê³¼ ì €ì¥                    â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   Redis (ElastiCache)               â”‚                   â”‚
â”‚  â”‚   - ê³¨í”„ì¥ ìœ„ì¹˜ ë°ì´í„° (GEO)          â”‚                   â”‚
â”‚  â”‚   - ì„¸ì…˜ ìºì‹œ                         â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²
         â”‚ Terraform ê´€ë¦¬
         â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ platform-infra  â”‚
   â”‚   (IaC ì½”ë“œ)    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì´ ì„œë¹„ìŠ¤ì˜ ì—­í• 

### âœ… ë‹´ë‹¹í•˜ëŠ” ê²ƒ
- ì˜ìƒ ì „ì²˜ë¦¬ (FFmpeg í‘œì¤€í™”)
- ê³¨ê²© ì¶”ì¶œ (MediaPipe Pose)
- Phase ê°ì§€ (LSTM ëª¨ë¸)
- ê°ë„ ê³„ì‚° (ìˆ˜í•™ ë¡œì§)
- ì§„ë‹¨ ìƒì„± (Thresholds ê·œì¹™ ë§¤ì¹­)
- JSON ì‘ë‹µ ë°˜í™˜

### âŒ ë‹´ë‹¹í•˜ì§€ ì•ŠëŠ” ê²ƒ
- ì‚¬ìš©ì ì¸ì¦ â†’ NestJSê°€ ì²˜ë¦¬
- DB ì €ì¥ â†’ NestJSê°€ ì²˜ë¦¬
- ê³¨í”„ì¥ ê²€ìƒ‰ â†’ NestJS + Redis
- í”„ë¡ íŠ¸ì—”ë“œ ë Œë”ë§ â†’ Mobile App

**í•µì‹¬: ì´ ì„œë¹„ìŠ¤ëŠ” ì™„ì „íˆ Stateless!**

---

## ë°ì´í„° íë¦„

### 1ï¸âƒ£ ì‚¬ìš©ìê°€ ìŠ¤ìœ™ ì˜ìƒ ì—…ë¡œë“œ
```
[Mobile] â†’ [NestJS API] POST /swing-analysis
  Body: { video: File, userId: 123 }
```

### 2ï¸âƒ£ NestJSê°€ AI ì„œë¹„ìŠ¤ í˜¸ì¶œ
```typescript
// NestJS ì½”ë“œ ì˜ˆì‹œ
const formData = new FormData();
formData.append('file', videoFile.buffer, 'swing.mp4');
formData.append('side', 'right');
formData.append('club', 'iron');

const aiResponse = await this.httpService.post(
  `${AI_SERVICE_URL}/analyze`,
  formData,
  { timeout: 30000 }
).toPromise();
```

### 3ï¸âƒ£ FastAPI(ì—¬ê¸°)ì—ì„œ ë¶„ì„
```python
# app/analyze/service.py
def analyze_swing(file_path, side, club):
    # 1. ì „ì²˜ë¦¬
    preprocessed = preprocess_video(file_path)
    
    # 2. ê³¨ê²© ì¶”ì¶œ
    landmarks = PoseExtractor().extract(preprocessed)
    
    # 3. Phase ê°ì§€
    phases = detect_phases(landmarks)  # LSTM
    
    # 4. ê°ë„ ê³„ì‚°
    metrics = calculate_metrics(landmarks, phases)
    
    # 5. ì§„ë‹¨ ìƒì„±
    diagnosis = apply_thresholds(metrics, club)
    
    return {
        "swingId": uuid4(),
        "metrics": metrics,
        "phases": phases,
        "diagnosis_by_phase": diagnosis
    }
```

### 4ï¸âƒ£ ê²°ê³¼ ë°˜í™˜ ë° ì €ì¥
```
[FastAPI] â†’ JSON â†’ [NestJS]
                       â†“
                  [MySQL ì €ì¥]
                       â†“
                  [Mobileì— ì‘ë‹µ]
```

---

## Phase ê°ì§€ ì•Œê³ ë¦¬ì¦˜

### ML ê¸°ë°˜ (ê¸°ë³¸)
```python
# app/ml/phase_lstm.py
class PhaseLSTM(nn.Module):
    """
    ì…ë ¥: (batch, seq_len, features)
    - features: elbow, knee, spine_tilt ë“±
    
    ì¶œë ¥: (batch, 7)  # P2~P9 ì¤‘ 7ê°œ Phase ì¸ë±ìŠ¤
    """
    def __init__(self):
        self.lstm = nn.LSTM(input_size=6, hidden_size=64, num_layers=2)
        self.fc = nn.Linear(64, 7)
```

**í•™ìŠµ ë°ì´í„°:**
- `data/raw/pros/`: í”„ë¡œ ê³¨í¼ ìŠ¤ìœ™ ì˜ìƒ
- `scripts/video_to_csv.py`ë¡œ ë³€í™˜
- Phase ë¼ë²¨ì€ ìˆ˜ë™ íƒœê¹…

---

## Thresholds ì‹œìŠ¤í…œ

### ì„¤ì • íŒŒì¼ êµ¬ì¡°
```json
{
  "default": {
    "elbow_avg": { "bins": [...] }
  },
  "clubs": {
    "driver": {
      "elbow_avg": { "bins": [...] }  // driver ì „ìš© ê·œì¹™
    }
  }
}
```

### ì ìš© ë¡œì§
```python
# 1. default ê·œì¹™ ë¡œë“œ
rules = thresholds["default"]

# 2. í´ëŸ½ë³„ ê·œì¹™ ë³‘í•©
if club in thresholds["clubs"]:
    rules.update(thresholds["clubs"][club])

# 3. ê° ë©”íŠ¸ë¦­ì— ì ìš©
for key, value in metrics.items():
    if key in rules:
        diagnosis[key] = match_bins(value, rules[key]["bins"])
```

---

## ë°°í¬ ì•„í‚¤í…ì²˜ (í–¥í›„)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           AWS Cloud                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚     ALB     â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚         â”‚                              â”‚
â”‚         â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚       ECS Cluster           â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚
â”‚  â”‚  â”‚ NestJS   â”‚ â”‚ FastAPI  â”‚  â”‚      â”‚
â”‚  â”‚  â”‚ Task     â”‚ â”‚ Task     â”‚  â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚              â”‚              â”‚
â”‚         â–¼              â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   RDS    â”‚   â”‚ElastiCacheâ”‚         â”‚
â”‚  â”‚  MySQL   â”‚   â”‚   Redis   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ê´€ë¦¬:** [platform-infra](https://github.com/wjdghtls95/platform-infra) Terraform

---

## ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

### í˜„ì¬ ìƒíƒœ
- CPU ëª¨ë“œ (MediaPipe)
- ë™ê¸° ì²˜ë¦¬
- 1ê°œ ìš”ì²­ë‹¹ ì•½ 5~8ì´ˆ

### ë³‘ëª© ì§€ì 
1. **ì „ì²˜ë¦¬ (FFmpeg)**: 2~3ì´ˆ
2. **ê³¨ê²© ì¶”ì¶œ (MediaPipe)**: 2~3ì´ˆ
3. **Phase ê°ì§€ (LSTM)**: 0.5ì´ˆ
4. **ê°ë„ ê³„ì‚°**: 0.2ì´ˆ

### í–¥í›„ ìµœì í™” ê³„íš
- [ ] ë¹„ë™ê¸° í (Celery) â†’ ë™ì‹œ ì²˜ë¦¬ 10ë°°
- [ ] GPU ê°€ì† â†’ ë¶„ì„ ì‹œê°„ 60% ë‹¨ì¶•
- [ ] í”„ë ˆì„ ìƒ˜í”Œë§ â†’ ì²˜ë¦¬ ì†ë„ 40% í–¥ìƒ

---

## ë‹¤ìŒ ë‹¨ê³„

- [ğŸ“– API Reference](api.md)
- [ğŸ“– Development Guide](dev_guide.md)
- [ğŸ“– Module Reference](module_reference.md)
